#!/usr/bin/env bash

# Database Setup Script for <%= appName %>
# This script helps set up PostgreSQL database for the Rails application

set -e

echo "Setting up database..."

# Wait for PostgreSQL to be ready
echo "Waiting for PostgreSQL to be ready..."
until bundle exec rails db:version 2>/dev/null; do
  echo "PostgreSQL is unavailable - sleeping"
  sleep 2
done

echo "PostgreSQL is ready!"

# Create database if it doesn't exist
echo "Creating database..."
bundle exec rails db:create

# Run migrations
echo "Running migrations..."
bundle exec rails db:migrate

# Seed database (if seeds exist)
if [ -f db/seeds.rb ]; then
  echo "Seeding database..."
  bundle exec rails db:seed
fi

echo "Database setup complete!"
